version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: retro-mike-mflex-miningcore-helper_web_1
      APP_PORT: 8080

  web:
    image: python:3.12-alpine
    user: "1000:1000"
    restart: unless-stopped
    command: ["python", "/srv/mflex_helper.py"]
    volumes:
      - ./server:/srv:ro
      - /home/umbrel/.miningcore:/mc
    environment:
      # MFLEX RPC (container name is reachable on umbrel_main_network)
      MFLEX_RPC_HOST: retro-mike-mflex-node_node_1
      MFLEX_RPC_PORT: "9010"
      MFLEX_RPC_USER: pooluser
      MFLEX_RPC_PASS: poolpassword
      MFLEX_WALLET: pool
      MFLEX_ADDR_TYPE: legacy

      # Miningcore config
      POOL_ID: mflex
      MININGCORE_CONFIG: /mc/config.json
